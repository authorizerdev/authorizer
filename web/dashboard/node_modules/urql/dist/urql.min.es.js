import{createClient as e,createRequest as n}from"@urql/core";export*from"@urql/core";import{createContext as t,useContext as r,useRef as u,useState as i,useCallback as o,useEffect as c,useMemo as a}from"react";import{toPromise as f,subscribe as s,onPush as l,takeWhile as v,onEnd as p}from"wonka";var y=t(e({url:"/graphql"})),d=y.Provider,h=y.Consumer;function x(){return r(y)}function g(){return(g=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}y.displayName="UrqlContext";var b={fetching:!1,stale:!1,error:void 0,data:void 0,extensions:void 0,operation:void 0};function q(e,n){var t=g({},e,n,{fetching:!!n.fetching,stale:!!n.stale});return function(e,n){if("object"!=typeof e||"object"!=typeof n)return e!==n;for(var t in e)if(!(t in n))return!0;for(var r in n)if(e[r]!==n[r])return!0;return!1}(e,t)?t:e}function k(e,n){for(var t=0,r=n.length;t<r;t++)if(e[t]!==n[t])return!0;return!1}function m(e){var t=u(!0),r=x(),a=i(b),s=a[0],l=a[1],v=o((function(u,i){return l(g({},b,{fetching:!0})),f(r.executeMutation(n(e,u),i||{})).then((function(e){return t.current&&l({fetching:!1,stale:!!e.stale,data:e.data,error:e.error,extensions:e.extensions,operation:e.operation}),e}))}),[r,e,l]);return c((function(){return function(){t.current=!1}}),[]),[s,v]}function P(e,t){var r=u(void 0);return a((function(){var u=n(e,t);return void 0!==r.current&&r.current.key===u.key?r.current:(r.current=u,u)}),[e,t])}var w=!1;function j(e){var n=x(),t=function(e){if(!e._react){var n=new Set,t=new Map;e.operations$&&s((function(e){"teardown"===e.kind&&n.has(e.key)&&(n.delete(e.key),t.delete(e.key))}))(e.operations$),e._react={get:function(e){return t.get(e)},set:function(e,r){n.delete(e),t.set(e,r)},dispose:function(e){n.add(e)}}}return e._react}(n),r=function(e,n){return e.suspense&&(!n||!1!==n.suspense)}(n,e.context),u=P(e.query,e.variables),f=a((function(){if(e.pause)return null;var i=n.executeQuery(u,g({},{requestPolicy:e.requestPolicy},e.context));return r?l((function(e){t.set(u.key,e)}))(i):i}),[t,n,u,r,e.pause,e.requestPolicy,e.context]),y=o((function(e,n){if(!e)return{fetching:!1};var r=t.get(u.key);if(r){if(n&&null!=r&&"then"in r)throw r}else{var i,o=s((function(e){r=e,i&&i(r)}))(v((function(){return n&&!i||!r}))(e));if(null==r&&n){var c=new Promise((function(e){i=e}));throw t.set(u.key,c),c}o.unsubscribe()}return r||{fetching:!0}}),[t,u]),d=[n,u,e.requestPolicy,e.context,e.pause],h=i((function(){w=!0;try{return[f,q(b,y(f,r)),d]}finally{w=!1}})),m=h[0],j=h[1],Q=m[1];return f!==m[0]&&k(m[2],d)&&j([f,Q=q(m[1],y(f,r)),d]),c((function(){var e=m[0],n=m[2][1],r=!1;function u(e){r=!0,w||j((function(n){var t=q(n[1],e);return n[1]!==t?[n[0],t,n[2]]:n}))}if(e){var i=s(u)(p((function(){u({fetching:!1})}))(e));return r||u({fetching:!0}),function(){t.dispose(n.key),i.unsubscribe()}}u({fetching:!1})}),[t,m[0],m[2][1]]),[Q,o((function(i){var o=g({},{requestPolicy:e.requestPolicy},e.context,i);j((function(e){return[r?l((function(e){t.set(u.key,e)}))(n.executeQuery(u,o)):n.executeQuery(u,o),e[1],d]}))}),[n,t,u,r,y,e.requestPolicy,e.context])]}function Q(e,n){var t=x(),r=P(e.query,e.variables),f=u(n);f.current=n;var l=a((function(){return e.pause?null:t.executeSubscription(r,e.context)}),[t,r,e.pause,e.context]),v=[t,r,e.context,e.pause],y=i((function(){return[l,g({},b,{fetching:!!l}),v]})),d=y[0],h=y[1],m=d[1];return l!==d[0]&&k(d[2],v)&&h([l,m=q(d[1],{fetching:!!l}),v]),c((function(){function e(e){h((function(n){var t=q(n[1],e);return n[1]===t?n:(f.current&&n[1].data!==t.data&&(t.data=f.current(n[1].data,t.data)),[n[0],t,n[2]])}))}if(d[0])return s(e)(p((function(){e({fetching:!1})}))(d[0])).unsubscribe;e({fetching:!1})}),[d[0]]),[m,o((function(n){var u=t.executeSubscription(r,g({},e.context,n));h((function(e){return[u,e[1],e[2]]}))}),[t,e.context,r])]}function S(e){var n=m(e.query);return e.children(g({},n[0],{executeMutation:n[1]}))}function M(e){var n=j(e);return e.children(g({},n[0],{executeQuery:n[1]}))}function O(e){var n=Q(e,e.handler);return e.children(g({},n[0],{executeSubscription:n[1]}))}export{h as Consumer,y as Context,S as Mutation,d as Provider,M as Query,O as Subscription,x as useClient,m as useMutation,j as useQuery,Q as useSubscription};
//# sourceMappingURL=urql.min.es.js.map
